define(["jquery","template","base64"],function(e,i){var c=1,s=null,t=window.localStorage,a=parseInt(e(".read-main").css("font-size")),n=t.getItem("fontSize")||16,o=t.getItem("background")||"#CBC38B";e(".read-main").css("font-size",n+"px"),e(".read-main").css("background",o);c=t.getItem("chapter_id")||1;function r(){t.setItem("chapter_id",c),e.ajax({url:"/book/read?article="+c,dataType:"json",success:function(n){var t,a,o=n.jsonp;t=o,(a=document.createElement("script")).src=t,window.duokan_fiction_chapter=function(n){var n=JSON.parse(e.base64().decode(n));e(".read-main").empty(),i(e(".main").html(),{lists:n},".read-main");var t=s.length;e(".num").html(c+"/"+t),document.head.removeChild(a)},document.head.appendChild(a)}})}e.ajax({url:"/book/catalog",dataType:"json",success:function(n){s=n.item.toc,console.log(s)}}),r(),e(".read-main").on("click",function(){e(".mask").addClass("show")}),e(".mask-middle").on("click",function(){e(".mask").removeClass("show")}),e(".catalog-btn").on("click",function(n){n.stopPropagation(),e(".paging").css("transform"," translate3d(0, 0, 0)"),i(e(".catalogue").html(),{list:s},".paging")}),e(".paging").on("click","li",function(){c=e(this).data("id"),r(),e(".paging").css("transform"," translate3d(100%, 0, 0)"),e(".mask").removeClass("show")}),e(".left").on("click",function(){e(".paging").css("transform"," translate3d(100%, 0, 0)")}),e(".prev-btn").on("click",function(){if(c<=0)return!1;c--,r()}),e(".next-btn").on("click",function(){if(c>=s.length)return!1;c++,r()}),e(".font").on("click",function(){e(".main-font").toggleClass("main-font-s")}),e(".big-btn").on("click",function(n){n.stopPropagation(),e(".read-main h3").css("fontSize",a++),e(".read-main p").css("fontSize",a++),t.setItem("fontSize",a)}),e(".small-btn").on("click",function(n){n.stopPropagation(),e(".read-main h3").css("fontSize",a--),e(".read-main p").css("fontSize",a--),t.setItem("fontSize",a)}),e(".main-font-b").on("click","b",function(){var n=e(this).css("background");e(".read-main").css("background",n),t.setItem("background",n)}),e(".time").on("click",function(){e(".read-main").toggleClass(".blick")})});